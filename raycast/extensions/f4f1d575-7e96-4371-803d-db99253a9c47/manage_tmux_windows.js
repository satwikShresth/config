"use strict";var A=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var O=(e,n)=>{for(var o in n)A(e,o,{get:n[o],enumerable:!0})},G=(e,n,o,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of U(n))!z.call(e,i)&&i!==o&&A(e,i,{get:()=>n[i],enumerable:!(t=H(n,i))||t.enumerable});return e};var K=e=>G(A({},"__esModule",{value:!0}),e);var R={};O(R,{default:()=>D});module.exports=K(R);var f=require("react"),c=require("@raycast/api");var a=require("@raycast/api"),b=require("@raycast/api"),x=require("react");var h=require("child_process");function I(e){let n=`${e}/Contents/Info.plist`,o=["CFBundleIconFile","CFBundleIconName"],t=null;for(let p of o)try{t=(0,h.execSync)(["plutil","-extract",p,"raw",'"'+n+'"'].join(" ")).toString().trim();break}catch{continue}if(!t)return"";t.endsWith(".icns")||(t=`${t}.icns`);let i=`${e}/Contents/Resources/${t}`;return console.log(i),i}var u=require("react/jsx-runtime"),M=["net.kovidgoyal.kitty","org.alacritty","com.googlecode.iterm2","com.apple.Terminal","dev.warp.Warp-Stable","com.github.wez.wezterm"],N=({setIsTerminalSetup:e})=>{let[n,o]=(0,x.useState)(),[t,i]=(0,x.useState)(!0),{pop:p}=(0,a.useNavigation)();return(0,x.useEffect)(()=>{(async()=>{i(!0);let s=(await(0,a.getApplications)()).filter(l=>M.includes(l.bundleId||""));o(s),i(!1)})()},[]),(0,u.jsxs)(a.Form,{enableDrafts:!0,isLoading:t,navigationTitle:"Select Terminal App",actions:(0,u.jsx)(a.ActionPanel,{children:(0,u.jsx)(a.Action.SubmitForm,{title:"Submit Terminal App Name",onSubmit:async s=>{b.LocalStorage.setItem("terminalAppBundleId",s.terminalAppBundleId);let l=await(0,a.showToast)({style:a.Toast.Style.Animated,title:"Setup Terminal"});l.style=a.Toast.Style.Success,l.message=`Terminal ${s.terminalAppBundleId} is setup successfully for tmux sessioner`,e&&e(!0),p()}})}),children:[(0,u.jsx)(a.Form.Description,{text:"Choose your default terminal App"}),(0,u.jsx)(a.Form.Description,{text:"When switch to session, it will open the session in the selected terminal app."}),(0,u.jsx)(a.Form.Dropdown,{id:"terminalAppBundleId",isLoading:t,children:n?.map((s,l)=>(0,u.jsx)(a.Form.Dropdown.Item,{value:s.bundleId||"",title:s.name,icon:I(s.path)},l))})]})};var d=require("@raycast/api"),W=require("child_process");async function k(e){let n=await d.LocalStorage.getItem("terminalAppBundleId"),o=await(0,d.showToast)({style:d.Toast.Style.Animated,title:"Checking terminal App setup"});return n?(o.hide(),e(!0),!0):(o.style=d.Toast.Style.Failure,o.title="No default terminal setup for tmux sessioner",e(!1),!1)}async function v(){let e=await d.LocalStorage.getItem("terminalAppBundleId");(0,W.execSync)(`open -b ${e}`)}var y=require("child_process");var g=Object.assign({},process.env,{PATH:"/usr/local/bin:/usr/bin:/opt/homebrew/bin"});var m=require("@raycast/api");function P(e){return(0,y.exec)('tmux list-windows -aF "#{session_name}:#{window_name}:#{window_index}"',{env:g},e)}async function $(e,n){let o=await(0,m.showToast)({style:m.Toast.Style.Animated,title:""});n(!0);let{sessionName:t,windowIndex:i,windowName:p}=e;(0,y.exec)(`tmux switch -t ${t}`,{env:g},async(s,l,w)=>{if(s||w){console.error(`exec error: ${s||w}`),o.style=m.Toast.Style.Failure,o.title="No tmux client found \u{1F622}",o.message=s?s.message:w,n(!1);return}(0,y.execSync)(`tmux select-window -t ${i}`,{env:g});try{await v(),o.style=m.Toast.Style.Success,o.title=`Switched to window ${p}`,await(0,m.showHUD)(`Switched to window ${p}`),n(!1)}catch{o.style=m.Toast.Style.Failure,o.title="Terminal not supported \u{1F622}",n(!1)}})}async function F(e,n,o){n(!0);let t=await(0,m.showToast)({style:m.Toast.Style.Animated,title:""});(0,y.exec)(`tmux kill-window -t ${e.sessionName}:${e.windowName}`,{env:g},(i,p,s)=>{if(i||s){console.error(`exec error: ${i||s}`),t.style=m.Toast.Style.Failure,t.title="Something went wrong \u{1F622}",t.message=i?i.message:s,n(!1);return}t.style=m.Toast.Style.Success,t.title=`Deleted window ${e.windowName}`,o(),n(!1)})}var r=require("react/jsx-runtime");function D(){let[e,n]=(0,f.useState)([]),[o,t]=(0,f.useState)(!0),[i,p]=(0,f.useState)(!1),s=()=>{P((l,w)=>{if(l){console.error(`exec error: ${l}`),t(!1);return}let S=w.trim().split(`
`);if(S?.length>0){let T=0,B=S.map(C=>{let[L,E,_]=C.split(":");return T+=1,{keyIndex:T,sessionName:L,windowIndex:parseInt(_),windowName:E}});n(B)}t(!1)})};return(0,f.useEffect)(()=>{(async()=>{if(t(!0),!await k(p)){t(!1);return}})()},[]),(0,f.useEffect)(()=>{i&&(t(!0),s())},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.List,{isLoading:o,children:e.map((l,w)=>(0,r.jsx)(c.List.Item,{icon:c.Icon.Window,title:l.windowName,subtitle:l.sessionName,actions:(0,r.jsxs)(c.ActionPanel,{children:[(0,r.jsx)(c.Action,{title:"Switch To Selected Window",onAction:()=>$(l,t)}),(0,r.jsx)(c.Action,{title:"Delete This Window",onAction:()=>F(l,t,()=>n(e.filter(S=>S.keyIndex!==l.keyIndex))),shortcut:{modifiers:["cmd"],key:"d"}})]})},w))}),!i&&!o&&(0,r.jsx)(c.Detail,{markdown:"**Setup Default Terminal App Before Usage** `Go to Actions or using Cmd + k`",actions:(0,r.jsx)(c.ActionPanel,{children:(0,r.jsx)(c.Action.Push,{title:"Setup Here",target:(0,r.jsx)(N,{setIsTerminalSetup:p})})})})]})}
